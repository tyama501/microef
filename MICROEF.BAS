10 REM ******************
20 REM * MICRO E-FOREST *
30 REM * for ELKS       *
40 REM ******************
100 MODE 2
200 CLS 
300 COLOR 1,0
400 REM *************
410 REM * Variables *
420 REM *************
425 DIM MAP(20,10): DIM MDATA(9)
430 PX=INT(RND*9)+1: XINI=320: PY=INT(RND*9)+1: YINI=200: MAP(PX,PY)=9: MDATA(9)=0
440 PAKX=PX+1: PAKY=PY: PH=25: MXPH=30: TURN=0: DIST=0
450 DIM EX(4): DIM EY(4): DIM EAKX(4): DIM EAKY(4): DIM EH(4): DIM MXEH(4)
550 FOR I=1 TO 4
560 EX(I)=INT(RND*9)+I: EY(I)=INT(RND*9)+I
562 IF EX(I)>20 THEN EX(I)=20
564 IF EY(I)>10 THEN EY(I)=10
570 IF MAP(EX(I),EY(I))<>0 THEN GOTO 560
580 MAP(EX(I),EY(I))=I
590 EAKX(I)=EX(I): EAKY(I)=EY(I)
595 DIST=DIST+ABS(EX(I)-PX)+ABS(EY(I)-PY)
600 NEXT I
610 EH(1)=3: MXEH(1)=3: MDATA(1)=1
620 EH(2)=3: MXEH(2)=3: MDATA(2)=1
630 EH(3)=5: MXEH(3)=5: MDATA(3)=2
640 EH(4)=5: MXEH(4)=5: MDATA(4)=2
650 FOR I=1 TO 20
660 FOR J=1 TO 10
670 T=INT(RND*3)
675 IF MAP(I,J)=0 AND T=0 THEN MAP(I,J)=8: MDATA(8)=3
680 NEXT J
690 NEXT I
700 REM *************
710 REM * Main Code *
720 REM *************
730 POSITION 30,8
740 PRINT "MICRO E-FOREST for ELKS"
750 POSITION 35,10
760 PRINT "Press Enter"
770 INPUT A$
775 CLS
777 COLOR 1,0: FOR Y=0 TO 399: PLOT 0,Y: DRAW 639,Y: NEXT Y
779 COLOR 0,0: FOR Y=YINI TO YINI+81: PLOT XINI+7,Y: DRAW XINI+168,Y: NEXT Y 
780 COLOR 7,0: PLOT XINI+7, YINI
782 DRAW XINI+168, YINI
784 DRAW XINI+168, YINI+81
786 DRAW XINI+7, YINI+81
788 DRAW XINI+7, YINI 
790 FOR K=1 TO 20
795 FOR L=1 TO 10
797 T=MAP(K,L)
800 IF T<>0 THEN X1=K*8+XINI: Y1=L*8+YINI: D1=MDATA(T): GOSUB 5000
810 NEXT L
820 NEXT K
830 REM Instruction
834 POSITION 5,8: PRINT "Keys"
832 POSITION 30,18: PRINT "Save the forest in minimum turns." 
836 POSITION 5,9: PRINT "8: Move Up"
838 POSITION 5,10: PRINT "2: Move Down"
840 POSITION 5,11: PRINT "4: Move Left"
842 POSITION 5,12: PRINT "6: Move Right"
844 POSITION 5,13: PRINT "a: Attack toward moving direction"
846 POSITION 5,14: PRINT "   or Cut the tree (+10 Turns)"
848 POSITION 5,15: PRINT "q: Quit"
850 REM Status
851 POSITION 20,2: PRINT "Player HP:  "
852 POSITION 20,2: PRINT "Player HP:";PH
853 POSITION 20,5: PRINT "Turns:";TURN 
854 POSITION 50,2: PRINT "Monster1 HP:";EH(1)  
856 POSITION 50,3: PRINT "Monster2 HP:";EH(2)  
858 POSITION 50,4: PRINT "Monster3 HP:";EH(3)  
860 POSITION 50,5: PRINT "Monster4 HP:";EH(4)  
870 IF PH=0 THEN GOTO 6000
880 IF EH(1)=0 AND EH(2)=0 AND EH(3)=0 AND EH(4)=0 THEN GOTO 6500
900 REM Player Action
910 PK$=INKEY$: PA=0
920 IF PK$="q" OR PK$="Q" THEN GOTO 10000
925 IF PK$="a" OR PK$="A" THEN PA=1: GOSUB 4000 
930 PPX=PX: PPY=PY: GOSUB 3000
960 IF PX<>PPX OR PY<>PPY THEN X1=PPX*8+XINI: Y1=PPY*8+YINI: MAP(PPX,PPY)=0: GOSUB 5500: X1=PX*8+XINI: Y1=PY*8+YINI: D1=0: MAP(PX,PY)=9: GOSUB 5000
970 IF PX=PPX AND PY=PPY AND PA=0 THEN GOTO 900
972 TURN=TURN+1
975 REM Monster Action
980 FOR M=1 TO 4
985 EA=0: GOSUB 4200
987 IF EA=1 THEN GOTO 1020
990 IF EH(M)=0 THEN GOTO 1020
1000 PEX=EX(M): PEY=EY(M): GOSUB 3100
1010 IF PEX<>EX(M) OR PEY<>EY(M) THEN X1=PEX*8+XINI: Y1=PEY*8+YINI: MAP(PEX,PEY)=0: GOSUB 5500: X1=EX(M)*8+XINI: Y1=EY(M)*8+YINI: D1=MDATA(M): MAP(EX(M),EY(M))=M: GOSUB 5000
1020 NEXT M
1030 GOTO 850
3000 REM Calculate player coordinate
3010 IF PK$="8" THEN PY=PY+1
3012 IF PK$="2" THEN PY=PY-1
3014 IF PK$="6" THEN PX=PX+1
3016 IF PK$="4" THEN PX=PX-1
3020 IF PY>10 THEN GOTO 3080
3030 IF PY<1 THEN GOTO 3080
3040 IF PX>20 THEN GOTO 3080
3050 IF PX<1 THEN GOTO 3080
3060 IF MAP(PX,PY)<>0 THEN GOTO 3080
3070 GOTO 3090
3080 PX=PPX: PY=PPY
3090 IF PK$="8" THEN PAKY=PY+1: PAKX=PX
3091 IF PK$="2" THEN PAKY=PY-1: PAKX=PX
3092 IF PK$="6" THEN PAKX=PX+1: PAKY=PY
3093 IF PK$="4" THEN PAKX=PX-1: PAKY=PY
3094 RETURN
3100 REM Calculate monster coordinate
3110 DEX=PX-EX(M): DEY=PY-EY(M)
3120 IF DEY>0 THEN EY(M)=EY(M)+1
3130 IF DEY<0 THEN EY(M)=EY(M)-1
3140 IF DEX>0 THEN EX(M)=EX(M)+1
3150 IF DEX<0 THEN EX(M)=EX(M)-1
3160 IF EY(M)>10 THEN GOTO 3220
3170 IF EY(M)<1 THEN GOTO 3220
3180 IF EX(M)>20 THEN GOTO 3220
3190 IF EX(M)<1 THEN GOTO 3220
3200 IF MAP(EX(M),EY(M))<>0 THEN GOTO 3220
3210 GOTO 3230
3220 EX(M)=PEX: EY(M)=PEY
3230 RETURN
4000 REM Player Attack
4010 IF PAKY>10 THEN GOTO 4100
4020 IF PAKY<1 THEN GOTO 4100
4030 IF PAKX>20 THEN GOTO 4100
4040 IF PAKX<1 THEN GOTO 4100 
4050 X1=PAKX*8+XINI: Y1=PAKY*8+YINI: D1=4: GOSUB 5000 
4055 IF MAP(PAKX,PAKY)=0 THEN GOSUB 5500: GOTO 4070
4060 D1=MDATA(MAP(PAKX,PAKY)): GOSUB 5000 
4070 FOR M=1 TO 4
4075 IF EH(M)=0 THEN GOTO 4090
4080 IF MAP(PAKX,PAKY)=M THEN EH(M)=EH(M)-1
4085 IF EH(M)=0 THEN MAP(PAKX,PAKY)=0: X1=PAKX*8+XINI: Y1=PAKY*8+YINI: GOSUB 5500
4090 NEXT M
4095 IF MAP(PAKX,PAKY)=8 THEN MAP(PAKX,PAKY)=0: TURN=TURN+10: X1=PAKX*8+XINI: Y1=PAKY*8+YINI: GOSUB 5500
4100 RETURN
4200 REM Monster Attack
4205 IF PH=0 OR EH(M) = 0 THEN GOTO 4280 
4210 DEX=PX-EX(M): DEY=PY-EY(M)
4220 IF DEX=0 AND DEY=1 THEN EAKX(M)=PX: EAKY(M)=PY: EA=1
4230 IF DEX=0 AND DEY=-1 THEN EAKX(M)=PX: EAKY(M)=PY: EA=1
4240 IF DEX=1 AND DEY=0 THEN EAKX(M)=PX: EAKY(M)=PY: EA=1
4250 IF DEX=-1 AND DEY=0 THEN EAKX(M)=PX: EAKY(M)=PY: EA=1
4260 IF EA=1 THEN X1=EAKX(M)*8+XINI: Y1=EAKY(M)*8+YINI: D1=5: GOSUB 5000
4270 IF EA=1 THEN D1=0: GOSUB 5000: PH=PH-1
4280 RETURN
5000 REM Create Character
5001 IF D1=0 THEN RESTORE 8010
5002 IF D1=1 THEN RESTORE 8190
5003 IF D1=2 THEN RESTORE 8370
5004 IF D1=3 THEN RESTORE 9000
5005 IF D1=4 THEN RESTORE 8100
5006 IF D1=5 THEN RESTORE 8470
5010 FOR J=0 TO 7
5020 READ DATA1$
5030 FOR I=0 TO 7
5040 C1$=MID$(DATA1$,I+1,1)
5050 CV=VAL(C1$)
5060 COLOR CV,0
5070 PLOT X1+I,Y1-J
5080 NEXT I
5090 NEXT J
5100 RETURN 
5500 REM Delete Character
5510 COLOR 0,0
5520 FOR J=0 TO 7
5530 PLOT X1,Y1-J
5540 DRAW X1+7,Y1-J
5550 NEXT J
5560 RETURN
6000 REM Fail 
6010 POSITION 30,20: PRINT "You failed to save the forest"
6020 POSITION 30,21: PRINT "Press Enter to end"
6030 INPUT A$
6040 GOTO 10000
6500 REM Success
6502 POSITION 30,19
6504 IF TURN<DIST/2+10 THEN PRINT "Excellent!": GOTO 6510
6506 IF TURN<DIST THEN PRINT "Great!": GOTO 6510 
6508 IF TURN<DIST*2 THEN PRINT "Good."
6510 POSITION 30,20: PRINT "You saved the forest in turn";TURN
6520 POSITION 30,21: PRINT "Press Enter to end"
6530 INPUT A$
6540 GOTO 10000
8000 REM Data
8010 REM Player Body
8020 DATA "00111103"
8030 DATA "01111116"
8040 DATA "01055016"
8050 DATA "33555536"
8060 DATA "66111116"
8070 DATA "66111113"
8080 DATA "66111100"
8090 DATA "00366300"
8100 REM Player Attack
8110 DATA "66622666"
8120 DATA "66622666"
8130 DATA "26622662"
8140 DATA "22266222"
8150 DATA "22266222"
8160 DATA "26622662"
8170 DATA "66622666"
8180 DATA "66622666"
8190 REM Monster1 Body
8200 DATA "00005000"
8210 DATA "50055505"
8220 DATA "50055505"
8230 DATA "50555505"
8240 DATA "55755755"
8250 DATA "05566550"
8260 DATA "00555500"
8270 DATA "00055000"
8370 REM Monster2 Body
8380 DATA "00111100"
8390 DATA "02200020"
8400 DATA "02200020"
8410 DATA "02000020"
8420 DATA "00600600"
8430 DATA "20066002"
8440 DATA "21111112"
8450 DATA "01122110"
8470 REM Monster Attack
8480 DATA "52222225"
8490 DATA "25222252"
8500 DATA "22522522"
8510 DATA "22255222"
8520 DATA "22255222"
8530 DATA "22522522"
8540 DATA "25222252"
8550 DATA "52222225"
9000 REM Tree
9010 DATA "00222200"
9020 DATA "02622620"
9030 DATA "02622620"
9040 DATA "02266220"
9050 DATA "00266200"
9060 DATA "00066000"
9070 DATA "00066000"
9080 DATA "00666600"
10000 REM END
10010 CLS
